<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Partial Least Squares Regression Models with Big Matrices • bigPLSR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Partial Least Squares Regression Models with Big Matrices">
<meta name="description" content="Fast partial least squares (PLS) for dense and out-of-core data. Provides SIMPLS (straightforward implementation of a statistically inspired modification of the PLS method) and NIPALS (non-linear iterative partial least-squares) solvers, plus kernel-style PLS variants (kernelpls and widekernelpls) with parity to pls. Optimized for bigmemory-backed matrices with streamed cross-products and chunked BLAS (Basic Linear Algebra Subprograms) (XtX/XtY and XXt/YX), optional file-backed score sinks, and deterministic testing helpers. Includes an auto-selection strategy that chooses between XtX SIMPLS, XXt (wide) SIMPLS, and NIPALS based on (n, p) and a configurable memory budget. About the package, Bertrand and Maumy (2023) &lt;https://hal.science/hal-05352069&gt;, and &lt;https://hal.science/hal-05352061&gt; highlighted fitting and cross-validating PLS regression models to big data. For more details about some of the techniques featured in the package, Dayal and MacGregor (1997) &lt;doi:10.1002/(SICI)1099-128X(199701)11:1%3C73::AID-CEM435%3E3.0.CO;2-%23&gt;, Rosipal &amp; Trejo (2001) &lt;https://www.jmlr.org/papers/v2/rosipal01a.html&gt;, Tenenhaus, Viennet, and Saporta (2007) &lt;doi:10.1016/j.csda.2007.01.004&gt;, Rosipal (2004) &lt;doi:10.1007/978-3-540-45167-9_17&gt;, Rosipal (2019) &lt;https://ieeexplore.ieee.org/document/8616346&gt;, Song, Wang, and Bai (2024) &lt;doi:10.1016/j.chemolab.2024.105238&gt;. Includes kernel logistic PLS with C++-accelerated alternating iteratively reweighted least squares (IRLS) updates, streamed reproducing kernel Hilbert space (RKHS) solvers with reusable centering statistics, and bootstrap diagnostics with graphical summaries for coefficients, scores, and cross-validation workflows, alongside dedicated plotting utilities for individuals, variables, ellipses, and biplots. The streaming backend uses far less memory and keeps memory bounded across data sizes. For PLS1, streaming is often fast enough while preserving a small memory footprint; for PLS2 it remains competitive with a bounded footprint. On small problems that fit comfortably in RAM (random-access memory), dense in-memory solvers are slightly faster; the crossover occurs as n or p grow and the Gram/cross-product cost dominates.">
<meta property="og:description" content="Fast partial least squares (PLS) for dense and out-of-core data. Provides SIMPLS (straightforward implementation of a statistically inspired modification of the PLS method) and NIPALS (non-linear iterative partial least-squares) solvers, plus kernel-style PLS variants (kernelpls and widekernelpls) with parity to pls. Optimized for bigmemory-backed matrices with streamed cross-products and chunked BLAS (Basic Linear Algebra Subprograms) (XtX/XtY and XXt/YX), optional file-backed score sinks, and deterministic testing helpers. Includes an auto-selection strategy that chooses between XtX SIMPLS, XXt (wide) SIMPLS, and NIPALS based on (n, p) and a configurable memory budget. About the package, Bertrand and Maumy (2023) &lt;https://hal.science/hal-05352069&gt;, and &lt;https://hal.science/hal-05352061&gt; highlighted fitting and cross-validating PLS regression models to big data. For more details about some of the techniques featured in the package, Dayal and MacGregor (1997) &lt;doi:10.1002/(SICI)1099-128X(199701)11:1%3C73::AID-CEM435%3E3.0.CO;2-%23&gt;, Rosipal &amp; Trejo (2001) &lt;https://www.jmlr.org/papers/v2/rosipal01a.html&gt;, Tenenhaus, Viennet, and Saporta (2007) &lt;doi:10.1016/j.csda.2007.01.004&gt;, Rosipal (2004) &lt;doi:10.1007/978-3-540-45167-9_17&gt;, Rosipal (2019) &lt;https://ieeexplore.ieee.org/document/8616346&gt;, Song, Wang, and Bai (2024) &lt;doi:10.1016/j.chemolab.2024.105238&gt;. Includes kernel logistic PLS with C++-accelerated alternating iteratively reweighted least squares (IRLS) updates, streamed reproducing kernel Hilbert space (RKHS) solvers with reusable centering statistics, and bootstrap diagnostics with graphical summaries for coefficients, scores, and cross-validation workflows, alongside dedicated plotting utilities for individuals, variables, ellipses, and biplots. The streaming backend uses far less memory and keeps memory bounded across data sizes. For PLS1, streaming is often fast enough while preserving a small memory footprint; for PLS2 it remains competitive with a bounded footprint. On small problems that fit comfortably in RAM (random-access memory), dense in-memory solvers are slightly faster; the crossover occurs as n or p grow and the Gram/cross-product cost dominates.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">bigPLSR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/bigPLSR-auto-selection.html">Automatic Algorithm Selection in bigPLSR</a></li>
    <li><a class="dropdown-item" href="articles/bigPLSR-kpls-streaming.html">Streaming Kernel PLS in bigPLSR: XX^T and Column-Chunked Variants</a></li>
    <li><a class="dropdown-item" href="articles/bootstrap-strategies.html">Bootstrap strategies for bigPLSR</a></li>
    <li><a class="dropdown-item" href="articles/cross-validation-ic.html">Cross-validation and Information Criteria in bigPLSR</a></li>
    <li><a class="dropdown-item" href="articles/double-rkhs-pls.html">Double RKHS PLS (rkhs_xy): Theory and Usage</a></li>
    <li><a class="dropdown-item" href="articles/external-pls-benchmarks-long.html">External PLS benchmarks for bigPLSR: detailed analysis</a></li>
    <li><a class="dropdown-item" href="articles/external-pls-benchmarks-short.html">Benchmarking bigPLSR against external PLS implementations</a></li>
    <li><a class="dropdown-item" href="articles/kf-pls.html">KF-PLS: Streaming PLS with Kalman-style updates</a></li>
    <li><a class="dropdown-item" href="articles/klogitpls.html">Kernel Logistic PLS</a></li>
    <li><a class="dropdown-item" href="articles/kpls_review.html">Kernel and Streaming PLS Methods in bigPLSR</a></li>
    <li><a class="dropdown-item" href="articles/plotting-guide.html">Visualising PLS Fits with bigPLSR</a></li>
    <li><a class="dropdown-item" href="articles/pls1-benchmark.html">Benchmarking PLS1 Implementations</a></li>
    <li><a class="dropdown-item" href="articles/pls2-benchmark.html">Benchmarking PLS2 Implementations</a></li>
    <li><a class="dropdown-item" href="articles/rkhs-overview.html">RKHS-based Algorithms in bigPLSR</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fbertran/bigPLSR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bigplsr-pls-regression-models-with-big-matrices-">bigPLSR, PLS Regression Models with Big Matrices <img src="reference/figures/logo_bigPLSR.svg" align="right" width="200"><a class="anchor" aria-label="anchor" href="#bigplsr-pls-regression-models-with-big-matrices-"></a>
</h1></div>
<div class="section level2">
<h2 id="frédéric-bertrand-and-myriam-maumy">Frédéric Bertrand and Myriam Maumy<a class="anchor" aria-label="anchor" href="#fr%C3%A9d%C3%A9ric-bertrand-and-myriam-maumy"></a>
</h2>
<!-- badges: start -->

<p><strong>bigPLSR</strong> provides <strong>fast, scalable Partial Least Squares (PLS)</strong> with two execution backends:</p>
<ul>
<li>
<strong>Dense</strong> (<code>backend = "arma"</code>): in-memory Armadillo/BLAS for speed.</li>
<li>
<strong>Big-matrix</strong> (<code>backend = "bigmem"</code>): chunked streaming over <code><a href="https://rdrr.io/pkg/bigmemory/man/big.matrix.html" class="external-link">bigmemory::big.matrix</a></code> for large data.</li>
</ul>
<p>Both <strong>PLS1</strong> (single response) and <strong>PLS2</strong> (multi-response) are supported. PLS2 uses <strong>SIMPLS on cross-products</strong> in both backends for numerical parity.</p>
<p>Recent updates bring additional solvers and tooling:</p>
<ul>
<li>
<strong>Kernel PLS</strong> and <strong>wide kernel PLS</strong> are available alongside SIMPLS/NIPALS.</li>
<li>Plot helpers now include unit circles, loading arrows and VIP bar charts.</li>
<li>New wrappers simplify prediction, information-criteria based component selection, cross-validation and bootstrapping workflows.</li>
<li>
<strong>Kalman-filter PLS</strong> and <strong>double RKHS</strong> solvers extend the modelling toolkit to streaming and dual-kernel settings.</li>
<li>Cross-validation and bootstrap helpers optionally run in parallel via the <a href="https://future.futureverse.org" class="external-link"><code>future</code></a> ecosystem.</li>
<li>Fresh vignettes cover RKHS usage, Kalman-filter state management and the plotting utilities showcased below.</li>
</ul>
<blockquote>
<p>The package is set up to be CRAN-friendly: the optional CBLAS fast path is <strong>off</strong> by default.</p>
</blockquote>
<p>Support for parallel computation and GPU is being developed.</p>
<p>This website and these examples were created by F. Bertrand and M. Maumy.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of bigPLSR from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"bigPLSR"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of bigPLSR from <a href="https://github.com" class="external-link">github</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"fbertran/bigPLSR"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/bigPLSR/">bigPLSR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span> <span class="op">-</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dense PLS1 (fast)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pls_fit.html">pls_fit</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, ncomp <span class="op">=</span> <span class="fl">3</span>, backend <span class="op">=</span> <span class="st">"arma"</span>, scores <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  coef<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span>,</span>
<span>  scores<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>,</span>
<span>  ncomp<span class="op">=</span><span class="va">fit</span><span class="op">$</span><span class="va">ncomp</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="big-matrix-pls1-with-file-backed-scores">Big-matrix PLS1 with file-backed scores<a class="anchor" aria-label="anchor" href="#big-matrix-pls1-with-file-backed-scores"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">options_val_before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"bigmemory.allow.dimnames"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>bigmemory.allow.dimnames<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bmX</span> <span class="op">&lt;-</span> <span class="fu">bigmemory</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bigmemory/man/big.matrix.html" class="external-link">as.big.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">bmy</span> <span class="op">&lt;-</span> <span class="fu">bigmemory</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bigmemory/man/big.matrix.html" class="external-link">as.big.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">tmp</span>,<span class="st">"scores.desc"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">tmp</span>,<span class="st">"scores.desc"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">tmp</span>,<span class="st">"scores.bin"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">tmp</span>,<span class="st">"scores.bin"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">sink</span> <span class="op">&lt;-</span> <span class="fu">bigmemory</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bigmemory/man/big.matrix.html" class="external-link">filebacked.big.matrix</a></span><span class="op">(</span></span>
<span>  nrow<span class="op">=</span><span class="va">n</span>, ncol<span class="op">=</span><span class="fl">3</span>, type<span class="op">=</span><span class="st">"double"</span>,</span>
<span>  backingfile<span class="op">=</span><span class="st">"scores.bin"</span>,</span>
<span>  backingpath<span class="op">=</span><span class="va">tmp</span>,</span>
<span>  descriptorfile<span class="op">=</span><span class="st">"scores.desc"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pls_fit.html">pls_fit</a></span><span class="op">(</span></span>
<span>  <span class="va">bmX</span>, <span class="va">bmy</span>, ncomp<span class="op">=</span><span class="fl">3</span>, backend<span class="op">=</span><span class="st">"bigmem"</span>, scores<span class="op">=</span><span class="st">"big"</span>,</span>
<span>  scores_target<span class="op">=</span><span class="st">"existing"</span>, scores_bm<span class="op">=</span><span class="va">sink</span>,</span>
<span>  scores_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t1"</span>,<span class="st">"t2"</span>,<span class="st">"t3"</span><span class="op">)</span>,</span>
<span>  return_scores_descriptor <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_b</span><span class="op">$</span><span class="va">scores_descriptor</span>  <span class="co"># big.matrix.descriptor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>bigmemory.allow.dimnames<span class="op">=</span><span class="va">options_val_before</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pls2-multi-response">PLS2 (multi-response)<a class="anchor" aria-label="anchor" href="#pls2-multi-response"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">*</span><span class="va">m</span><span class="op">)</span>, <span class="va">p</span>, <span class="va">m</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">B</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">m</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dense PLS2 – SIMPLS on cross-products (parity with bigmem)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pls_fit.html">pls_fit</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ncomp <span class="op">=</span> <span class="fl">2</span>, backend <span class="op">=</span> <span class="st">"arma"</span>, mode <span class="op">=</span> <span class="st">"pls2"</span>, scores <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coef<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span>, ncomp<span class="op">=</span><span class="va">fit2</span><span class="op">$</span><span class="va">ncomp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="api">API<a class="anchor" aria-label="anchor" href="#api"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pls_fit.html">pls_fit</a></span><span class="op">(</span></span>
<span>  <span class="va">X</span>, <span class="va">y</span>, <span class="va">ncomp</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-8</span>,</span>
<span>  backend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"arma"</span>, <span class="st">"bigmem"</span><span class="op">)</span>,</span>
<span>  scores  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"r"</span>, <span class="st">"big"</span><span class="op">)</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">10000L</span>,</span>
<span>  scores_name <span class="op">=</span> <span class="st">"scores"</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>,<span class="st">"pls1"</span>,<span class="st">"pls2"</span><span class="op">)</span>,</span>
<span>  scores_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>,<span class="st">"new"</span>,<span class="st">"existing"</span><span class="op">)</span>,</span>
<span>  scores_bm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scores_backingfile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scores_backingpath <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scores_descriptorfile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scores_colnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_scores_descriptor <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Auto selection</strong></p>
<ul>
<li>
<code>backend = "auto"</code> → <code>"bigmem"</code> when <code>X</code> is a <code>big.matrix</code> (or descriptor), else <code>"arma"</code>.</li>
<li>
<code>mode = "auto"</code> → <code>"pls1"</code> when <code>y</code> is one column, else <code>"pls2"</code>.</li>
</ul>
<p><strong>Return values</strong></p>
<ul>
<li>
<strong>PLS1:</strong> <code>coefficients</code> (p), <code>intercept</code> (scalar), <code>x_weights</code>, <code>x_loadings</code>, <code>y_loadings</code>, <code>scores</code> (optional), <code>x_means</code>, <code>y_mean</code>, <code>ncomp</code>.</li>
<li>
<strong>PLS2:</strong> <code>coefficients</code> (p×m), <code>intercept</code> (length m), <code>x_weights</code> (p×ncomp), <code>x_loadings</code> (p×ncomp), <code>y_loadings</code> (m×ncomp), <code>scores</code> (optional), <code>x_means</code>, <code>y_means</code>, <code>ncomp</code>.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="backends--algorithms">Backends &amp; algorithms<a class="anchor" aria-label="anchor" href="#backends--algorithms"></a>
</h2>
<div class="section level3">
<h3 id="dense-path-backend--arma">Dense path (<code>backend = "arma"</code>)<a class="anchor" aria-label="anchor" href="#dense-path-backend--arma"></a>
</h3>
<ul>
<li>
<strong>PLS1</strong>: fast dense solver (BLAS).</li>
<li>
<strong>PLS2</strong>: <strong>SIMPLS on cross-products</strong>
<ol style="list-style-type: decimal">
<li>Center <code>X</code>, <code>Y</code>, build <code>XtX = XcᵀXc</code>, <code>XtY = XcᵀYc</code>.<br>
</li>
<li>Cholesky-whitened symmetric eigen solve; enforce symmetry and add tiny ridge to stabilize.<br>
</li>
<li>Optional scores: <code>T = Xc %*% W</code>.</li>
</ol>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="big-matrix-path-backend--bigmem">Big-matrix path (<code>backend = "bigmem"</code>)<a class="anchor" aria-label="anchor" href="#big-matrix-path-backend--bigmem"></a>
</h3>
<ul>
<li>Chunked I/O from <code>big.matrix</code> with <strong>preallocated buffers</strong>.</li>
<li>
<strong>PLS1</strong>: streaming cross-products and deflation; optional scores streamed chunk-wise into a sink.</li>
<li>
<strong>PLS2</strong>: chunked <strong>cross-products</strong> (<code>XtX += BᵀB</code>, <code>XtY += BᵀY</code>) + the same <strong>SIMPLS</strong> solver for parity; optional score streaming: <code>T = (X − μ) %*% W</code>.</li>
</ul>
<blockquote>
<p>Both paths enforce symmetry (<code>0.5*(M+Mᵀ)</code>) before eigen and use a small ridge on <code>XtX</code> for stability.</p>
</blockquote>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="scores-sinks-and-descriptors">Scores, sinks, and descriptors<a class="anchor" aria-label="anchor" href="#scores-sinks-and-descriptors"></a>
</h2>
<ul>
<li>
<code>scores = "none"</code> – don’t compute scores.<br>
</li>
<li>
<code>scores = "r"</code> – return an in-memory matrix.<br>
</li>
<li>
<code>scores = "big"</code> – write to a <code>big.matrix</code>:
<ul>
<li>Provide a sink via <code>scores_target = "existing"</code> + <code>scores_bm</code> (big.matrix or descriptor), <strong>or</strong>
</li>
<li>Let the function create file-backed storage via <code>scores_backingfile</code> (+ optional <code>scores_backingpath</code>, <code>scores_descriptorfile</code>).</li>
</ul>
</li>
<li>
<code>scores_colnames</code> – set column names of the scores.</li>
<li>
<code>return_scores_descriptor = TRUE</code> – adds <code>fit$scores_descriptor</code> when <code>scores</code> is a <code>big.matrix</code>.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="determinism-tests--reproducibility">Determinism (tests &amp; reproducibility)<a class="anchor" aria-label="anchor" href="#determinism-tests--reproducibility"></a>
</h2>
<p>For tight parity tests, force <strong>1 BLAS thread</strong> and fix RNG:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"RhpcBLASctl"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">RhpcBLASctl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RhpcBLASctl/man/RhpcBLASctl-package.html" class="external-link">blas_set_num_threads</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Use env vars before BLAS loads in the session</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span></span>
<span>    OMP_NUM_THREADS<span class="op">=</span><span class="st">"1"</span>,</span>
<span>    OPENBLAS_NUM_THREADS<span class="op">=</span><span class="st">"1"</span>,</span>
<span>    MKL_NUM_THREADS<span class="op">=</span><span class="st">"1"</span>,</span>
<span>    VECLIB_MAXIMUM_THREADS<span class="op">=</span><span class="st">"1"</span>,</span>
<span>    BLIS_NUM_THREADS<span class="op">=</span><span class="st">"1"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="performance-tuning">Performance tuning<a class="anchor" aria-label="anchor" href="#performance-tuning"></a>
</h2>
<ul>
<li>
<strong>chunk_size</strong>: default <code>10000L</code>. On Apple Silicon, internal default is larger (e.g., <code>16384</code>) when <code>chunk_size == 0</code>. Tune per dataset for best GEMM throughput.</li>
<li>
<strong>Scores streaming</strong>: with <code>scores="big"</code>, streaming avoids holding <code>T</code> fully in RAM.</li>
<li>
<strong>Multi-thread BLAS</strong>: for production, allow multi-thread BLAS; for tests, use 1 thread.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="optional-cblas-fast-path-in-place-gemm">Optional CBLAS fast path (in-place GEMM)<a class="anchor" aria-label="anchor" href="#optional-cblas-fast-path-in-place-gemm"></a>
</h2>
<p><strong>Default: OFF (CRAN-safe).</strong><br>
An optional in-place accumulation (true <code>beta = 1</code> <strong>CBLAS</strong> <code>dgemm</code>) is available and <strong>guarded</strong> by compile-time checks. When not available or not enabled, the package <strong>falls back automatically</strong> to the portable Armadillo path.</p>
<p><strong>Enable locally (Unix/macOS):</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .   <span class="at">--configure-vars</span><span class="op">=</span><span class="st">"PKG_CPPFLAGS='-DBIGPLSR_USE_CBLAS'"</span></span></code></pre></div>
<p>In <code>src/Makevars</code>, link to the <strong>same BLAS/LAPACK that R uses</strong>:</p>
<pre class="make"><code>PKG_LIBS += $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)</code></pre>
<ul>
<li>macOS: the code attempts <code>&lt;vecLib/cblas.h&gt;</code>; on Linux/others: <code>&lt;cblas.h&gt;</code>.<br>
</li>
<li>If headers aren’t present, the build <strong>silently falls back</strong> to the portable GEMM path.</li>
<li>
<strong>Do not</strong> hardcode <code>-lopenblas</code> or <code>-framework Accelerate</code>; use R’s variables.</li>
</ul>
<p><strong>Windows:</strong> leave the macro off unless you’ve explicitly provided CBLAS headers/libs.</p>
<hr>
</div>
<div class="section level2">
<h2 id="development">Development<a class="anchor" aria-label="anchor" href="#development"></a>
</h2>
<ul>
<li>Unit tests compare dense vs big-matrix backends for both PLS1/PLS2 with tight tolerances.</li>
<li>Vignettes and examples keep datasets small; file-backed output uses <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you use <strong>bigPLSR</strong> in academic work, please cite this package and the SIMPLS method by de Jong (1993).</p>
<hr>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fbertran/bigPLSR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/fbertran/bigPLSR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bigPLSR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Frederic Bertrand <br><small class="roles"> Maintainer, author </small> <a href="https://orcid.org/0000-0002-0837-8281" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Myriam Maumy <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-4615-1512" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fbertran/bigPLSR/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/fbertran/bigPLSR/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/fbertran/bigPLSR/actions/workflows/rhub.yaml" class="external-link"><img src="https://github.com/fbertran/bigPLSR/actions/workflows/rhub.yaml/badge.svg" alt="R-hub"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Frederic Bertrand, Myriam Maumy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
